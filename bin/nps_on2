#!/usr/bin/python

import socket
import random
import cPickle
import time
import sys
import string
import os

NPS_IP = "scexaoNPS2"

hold = sys.argv # reading argument of command
hold.pop(0)     # throw away the command itself!

# simple test to avoid problem!
if len(hold) == 0:
    print "------------------------------------"
    print "          NPS2 contents             "
    print "------------------------------------"
    print "Port 1: SCExAO comp 4 primary"
    print "Port 2: SCExAO comp 2 redundant"
    print "Port 3: SCExAO 3"
    print "Port 4: OCAM power"
    print "Port 5: Tip/Tilt modulator"
    print "Port 6: Neon calibration source (FIRST)"
    print "Port 7: DM Vacuum Pump"
    print "Port 8: --"
    print "------------------------------------"
    print "Example of use of the command nps_on"
    print "------------------------------------"
    print "\n>>nps_on 3"
    print "turns on the outlet 3 on the NPS"
    print "outlet number is 1 <= # <= 8"
    print "\nSee also: nps_off"
    print "------------------------------------"
    exit()
else:
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.connect((NPS_IP, 23))
        sock.send("@@@@\r\n")
        time.sleep(0.1)
        print sock.recv(1024)
        time.sleep(0.1)

        cmd = "N0"+(str)(hold[0])+"\r\n"
        print cmd
        sock.send(cmd)
        time.sleep(1)
        print sock.recv(1024)
        time.sleep(1)
        sock.close()
        time.sleep(0.1)
    except:
        print ""
        print "-------------------------------------------------------"
        print "nps_on could not connect to NPS."
        print "check that environment variable NPS_IP is correctly set"
        print "-------------------------------------------------------"



